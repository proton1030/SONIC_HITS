<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="./static/favicon.ico">
    <title>sonic_hits</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans|Poiret+One|Josefin+Sans" rel="stylesheet">
    <style>
    	html, body{
    		height:100%;
    		width:100%;
    	}
    </style>
  </head>
  <body>
    <div id="app"></div>
    <!-- built files will be auto injected -->
  </body>
  <script>
  	/*
Script rewritten as of 6/7/15. 
*/

var c = document.getElementById("canvas"),
$ = c.getContext("2d"),
w = c.width = window.innerWidth;
h = c.height = window.innerHeight;
$.fillRect(0,0,w,h);
var x = y = 0;
var rnd;
var _ms = msX = msY = 1000; 

window.addEventListener('mousedown',function(e){
msX = (e.clientX-w/2)/w*2; 
msY = (e.clientY-h/2)/h*2; 
reset();
}, false);

document.onkeypress = function(e){
	y=(y==0)?1:0;   
}; 

function reset(e){  
			if(e){
				msX = Math.random()-.5;  
				msY = Math.random()-.5;  
      }
      rnd = Math.random();  
  
      x_splat = Math.cos(2 * rnd * Math.PI)/w*2;  
      y_splat = Math.sin(2 * rnd * Math.PI)/h*2;
  
        if(y == 0){    
          $.fillStyle="hsla(0,0%,0%,1)";
          $.fillRect(0,0,w,h);
        }
};

setInterval(function(t){
	if((msX * msX + msY * msY) > 2){ 
		reset(1);
	}
  x++;
  
	n = (Math.cos(x/100)+1)*Math.PI;   
	r = ~~((Math.cos(2*rnd*Math.PI+n)+1)/2*255);
	g = ~~((Math.sin(2*rnd*2*Math.PI+n)+1)/2*255);
	b = ~~((-Math.cos(2*rnd*Math.PI+n)+1)/2*255);
	$.fillStyle="rgb("+r+","+g+","+b+")";
  
	msX = msX + x_splat;   
	msY = msY + y_splat;  
  
	var x1 = msX; 
	var y1 = msY;  
	var i=0;  

	while(Math.sqrt(x1 * x1 + y1 * y1) < 2 && i < 500){
		$.fillRect(x1 * w/2 + w/2, y1 * h/2 + h/2,2,2);
		var x2 = x1 * x1-y1 *y1 + msX;
		var y2 = 2 * x1 * y1 + msY;
     x1 = x2;
     y1 = y2;
     i++;
	}
	if(y==1){
		$.fillStyle="hsla(0,0%,0%,1)";
		$.fillRect(0,0,w,h);
	}
},1);

window.addEventListener('resize',function(){
   c.width = w = window.innerWidth;
   c.height = h = window.innerHeight;
}.false);

  </script>
</html>
